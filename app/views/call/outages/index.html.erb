<%= render partial: 'call/top' %>
<h2 class="page-header"><%= @title %></h2>
<%= table_for @outages, title: @title, collapsible: true, icon: '/assets/fff/lightning.png' do |t|
  t.title_action call_new_outage_url, label: 'ახალი გათიშვა', icon: '/assets/fff/lightning_add.png'
  t.item_action ->(x){ call_edit_outage_url(id: x.id) }, icon: '/assets/fff/pencil.png'
  t.item_action ->(x){ call_delete_outage_url(id: x.id) }, icon: '/assets/fff/bin.png', method: 'delete', confirm: 'ნამდვილად გინდათ წაშლა?'
  t.text_field 'accnumb', tag: 'code', label: 'ობიქტის #', icon: ->(x){ x.active ? '/assets/fff/cancel.png' : '/assets/fff/tick.png' }
  t.text_field 'category_name', label: 'მიზეზი'
  t.text_field 'start', label: 'დასაწყისი', url: ->(x){ call_outage_url(id:x.id) }
  t.text_field 'end', label: 'დასასრული', url: ->(x){ call_outage_url(id:x.id) }
end %>

<h3 class="page-header">გათიშული ქუჩები</h3>
<table class="table table-bordered table-stripped">
  <thead>
    <tr>
      <th>ქუჩა</th>
      <th>გათიშვა</th>
      <th>პერიოდი</th>
      <th>რაოდ.</th>
    </tr>
  </thead>
  <tbody>
    <% if @streets.any? %>
      <% @streets.each do |str| %>
      <tr>
        <td>
          <strong><%= str.region %></strong> &mdash;
          <%= str.streetname %>
        </td>
        <td>
          <code><%= str.outage.accnumb %></code>
          <%= str.outage.category_name %>
        </td>
        <td>
          <%= str.outage.start %> &mdash; <%= str.outage.end %>
        </td>
        <td><code><%= str.count %></code> აბონენტი</td>
      </tr>
      <% end %>
    <% else %>
      <tr>
        <td colspan="4" style="padding:32px; color: #aaa; text-align: center;">ყველა ქუჩა განათებულია!</td>
      </tr>
    <% end %>
  </tbody>
</table>